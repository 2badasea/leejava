<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.bada.leejava.member.MemberMapper">

<select id="memberSelectList" resultType="co.bada.leejava.member.MemberVO">
	SELECT * 
	FROM MEMBER
</select>

<!-- 관리자 회원목록, 뷰로 가져오기 -->
<select id="v_memberSelectList" resultType="co.bada.leejava.member.MemberVO">
	SELECT * 
	FROM V_MEMBERLIST
</select>

<!-- 원래 이메일 중복여부와 로그인 용도를 위해 선언했지만, 단순히 정보만 조회하는 것으로, 이메일 여부와 -->
<select id="memberSelect" parameterType="co.bada.leejava.member.MemberVO"
resultType="co.bada.leejava.member.MemberVO">
	SELECT * FROM MEMBER WHERE M_EMAIL = #{m_email} 
		<if test="m_password !=null">
			AND M_PASSWORD = #{m_password}
		</if>
</select>
<!-- 이메일 아이디를 통해 salt값을 조회 -->
<!--  logger.Info 릃호출해서 봐야한다 -->
<select id="selectSalt" parameterType="co.bada.leejava.member.MemberVO" resultType="string">
	SELECT M_SALT 
	FROM MEMBER 
	WHERE M_EMAIL = #{m_email}
</select>


<insert id="memberInsert" parameterType="co.bada.leejava.member.MemberVO">
	INSERT INTO MEMBER VALUES(
		#{m_email}, #{m_nickname}, #{m_password}, sysdate, 
		#{m_joinpath}, #{m_phone}, #{m_address}, #{m_status}, #{m_birthdate}, #{m_salt})
</insert>

<update id="memberUpdate" parameterType="co.bada.leejava.member.MemberVO">
	UPDATE MEMBER SET 
		M_NICKNAME = #{m_nickname}, 
		M_PASSWORD = #{m_password}, 
		M_PHONE = #{m_phone}, 
		M_ADDRESS = #{m_address} 
</update>

<!-- 회원탈퇴의 경우 상태만 변경하고, 스케줄러나 프로지서를 통해 일주일 뒤에 완전 삭제가능한지 체크 -->
<delete id="memberDelete" parameterType="co.bada.leejava.member.MemberVO">
	UPDATE MEMBER SET M_STATUS = 'WITHDRAWL' WHERE M_EMAIL = #{m_email}
</delete>

<select id="memberEmailCheck" parameterType="co.bada.leejava.member.MemberVO" resultType="boolean">
	SELECT
		 CASE WHEN COUNT(*)=0  THEN 'TRUE'  ELSE 'FALSE' END 
	FROM MEMBER
	WHERE M_EMAIL = #{m_email}
</select>

<!-- 닉네임 중복체크 확인 -->
<select id="memberNicknameCheck" parameterType="co.bada.leejava.member.MemberVO" resultType="boolean">
	SELECT 
		CASE WHEN COUNT(*)=0 THEN 'TRUE' ELSE 'FALSE' END
	FROM MEMBER
	WHERE M_NICKNAME = #{m_nickname}
</select>

<!-- 동의약관 insert부분. -->
<insert id="memberJointerms" parameterType="co.bada.leejava.member.MemberVO">
	INSERT INTO JOINTERMS VALUES(
		#{m_email}, 
		#{m_privacy}, 
		#{m_promotion}
		)
</insert>
<!-- 새로운 비밀번호로 업데이트하는 구문 -->
<update id="ajaxNewPasswordUpdate" parameterType="co.bada.leejava.member.MemberVO">
	UPDATE MEMBER 
		SET M_SALT = #{m_salt}, 
			M_PASSWORD = #{m_password} 
	WHERE M_EMAIL = #{m_email}
</update>

<!-- 회원 개인 정보 조회 ( member테이블 + joinTerms 테이블 조인시킴. 나중에 정보 더 추가될 수도 있음. -->
<select id="memberMyInfoList" resultType="co.bada.leejava.member.MemberVO">
	SELECT  * 
		FROM MEMBER M INNER JOIN JOINTERMS  J
		ON M.M_EMAIL = J.M_EMAIL
		WHERE M.M_EMAIL = #{m_email}
</select>

<!-- 개인정보 페이지 닉네임 변경 신청 -->
<update id="ajaxNicknameUpdate" parameterType="co.bada.leejava.member.MemberVO">
	UPDATE MEMBER 
		SET M_NICKNAME = #{m_nickname} 
	WHERE M_EMAIL = #{m_email}
</update>



</mapper>