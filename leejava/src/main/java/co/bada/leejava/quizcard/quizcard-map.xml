<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.bada.leejava.quizcard.QuizcardMapper">

	<insert id="quizcardSetCreate" parameterType="co.bada.leejava.quizcard.QuizcardVO">
		INSERT INTO QUIZCARD VALUES(
			SET_NO_SEQ.NEXTVAL,   <!-- 시퀀스 적용. -->
			#{m_email},
			#{quizcard_set_name},
			TO_CHAR( SYSDATE, 'YYYY-MM-DD  HH:MI:SS'),
			TO_CHAR( SYSDATE, 'YYYY-MM-DD  HH:MI:SS'),
			0,
			#{quizcard_set_status},
			#{quizcard_set_intro},
			0,
			#{quizcard_type}
		)
	</insert>
	
	<select id="quizcardSetNoGet" resultType="int">
		SELECT LAST_NUMBER
			FROM USER_SEQUENCES
		WHERE SEQUENCE_NAME = 'SET_NO_SEQ'
	</select>
	
	<insert id="quizcardCategory" parameterType="co.bada.leejava.quizcard.QuizcardVO">
		insert into quizcard_category values(
			1,
			#{quizcard_set_no},
			#{quizcard_category}
		)
	</insert>
	
	<select id="quizcardSelect" resultType="co.bada.leejava.quizcard.QuizcardVO">
		SELECT Q.QUIZCARD_SET_NO, Q.QUIZCARD_SET_NAME, Q.QUIZCARD_SET_CDATE, 
				Q.QUIZCARD_SET_UDATE, Q.QUIZCARD_SET_STATUS, Q.QUIZCARD_SET_INTRO,
				 Q.QUIZCARD_TYPE ,C.QUIZCARD_CATEGORY 
		FROM QUIZCARD Q INNER JOIN QUIZCARD_CATEGORY C 
		ON Q.QUIZCARD_SET_NO = C.QUIZCARD_SET_NO
		WHERE Q.QUIZCARD_SET_NO = #{quizcard_set_no}
	</select>
	
	<!--퀴즈카드 첫 생성 이후 기본 question테이블 값. -->
	<insert id="firstQuestionInsert" parameterType="co.bada.leejava.quizcard.QuizcardVO">
		INSERT INTO QUIZCARD_QUESTION VALUES(
			TO_NUMBER( #{quizcard_set_no}||'0'||1 ),
			1,
			#{quizcard_set_no},
			'문제를 입력하세요',
			'힌트를 입력하세요',
			'답안을 입력하세요'
		)
	</insert>
	
	<!-- 퀴즈카드 메인페이지 게시판에 보여줄 목록 -->
	<select id="quizcardList" resultType="co.bada.leejava.quizcard.QuizcardVO">
		SELECT  S.QUIZCARD_SET_NO,  S.QUIZCARD_SET_HIT, S.QUIZCARD_SET_LIKEIT, 
				S.QUIZCARD_SET_CDATE, S.QUIZCARD_SET_UDATE, S.QUIZCARD_TYPE,
				S.QUIZCARD_SET_NAME, M.M_NICKNAME, C.QUIZCARD_CATEGORY
		FROM QUIZCARD S INNER JOIN QUIZCARD_CATEGORY C
							ON  S.QUIZCARD_SET_NO = C.QUIZCARD_SET_NO
						INNER JOIN MEMBER M
							ON M.M_EMAIL = S.M_EMAIL
		WHERE S.QUIZCARD_SET_STATUS = 'PUBLIC'				
		ORDER BY S.QUIZCARD_SET_NO DESC
	</select>
</mapper>