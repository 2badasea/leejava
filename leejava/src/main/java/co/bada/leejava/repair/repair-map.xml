<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.bada.leejava.repair.RepairMapper">

	<!-- 유지보수 게시판의 페이징을 출력하기 위한 사전정보 (총 게시글의 갯수 구하기) -->	
	<select id="getRepairListCnt" resultType="int">
		SELECT COUNT(*) 
			FROM REPAIR 
			<trim prefix="where" prefixOverrides="and | or">
				<if test="rcategory != 'ALL' ">AND LIKE '%'||#{rcategory}||'%' </if>
				<!-- 밑의 중요도(rgrade)와 진행상태(rstatus)의 경우=> 검색차에는 없지만 별도의 select박스에서 보낸다. -->
				<if test="rgrade != 'ALL' ">AND LIKE '%'||#{rgrade}||'%'</if>
				<if test="rstatus != 'ALL' ">AND LIKE '%'||#{rstatus}||'%'</if>
				<if test="rtitle != '' and rtitle != null ">AND LIKE '%'||#{rtitile}||'%'</if>
				<if test="rcontent !='' and rcontent != null">AND LIKE '%'||#{rcontent}||'%'</if>
				<if test="m_email !='' and m_email != null ">AND LIKE '%'||#{m_email}||'%'</if>
			</trim>
			<trim prefix="ORDER BY">
				<!-- 출력되는 순서에 관한 조건 값들 =>  -->
				<if test="rtimeorder != 'DESC' ">RWDATE #{rtimeorder}</if>
			</trim>
	</select>
	
	
	
	<!-- 유지보수 건수 등록 -->
	<insert id="repairInsert" parameterType="co.bada.leejava.repair.RepairVO">
		INSERT INTO REPAIR 
			VALUES(
				(SELECT NVL(MAX(RNO)+1, 1) FROM REPAIR)
				, #{rcategory}
				, #{rtitle}
				, #{rcontent}   
				, TO_CHAR(SYSDATE, 'YY-MM-DD HH24:MI:SS')
				, ''
			    , #{rstatus}
				, #{m_email}
			    , #{rgrade}
			)
	</insert>
	
	
</mapper>